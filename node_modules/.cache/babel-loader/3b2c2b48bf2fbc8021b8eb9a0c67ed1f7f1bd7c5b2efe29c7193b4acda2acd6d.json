{"ast":null,"code":"import { wait } from '../wait.js';\nexport function withRetry(fn) {\n  let {\n    delay: delay_ = 100,\n    retryCount = 2,\n    shouldRetry = () => true\n  } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return new Promise((resolve, reject) => {\n    const attemptRetry = async function () {\n      let {\n        count = 0\n      } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      const retry = async _ref => {\n        let {\n          error\n        } = _ref;\n        const delay = typeof delay_ === 'function' ? delay_({\n          count,\n          error\n        }) : delay_;\n        if (delay) await wait(delay);\n        attemptRetry({\n          count: count + 1\n        });\n      };\n      try {\n        const data = await fn();\n        resolve(data);\n      } catch (err) {\n        if (count < retryCount && (await shouldRetry({\n          count,\n          error: err\n        }))) return retry({\n          error: err\n        });\n        reject(err);\n      }\n    };\n    attemptRetry();\n  });\n}","map":{"version":3,"names":["wait","withRetry","fn","delay","delay_","retryCount","shouldRetry","arguments","length","undefined","Promise","resolve","reject","attemptRetry","count","retry","_ref","error","data","err"],"sources":["/Users/toji.inoue/Desktop/卒業研究_井上登司フォルダ/web3-sotuken/node_modules/viem/utils/promise/withRetry.ts"],"sourcesContent":["import { wait } from '../wait.js'\n\nexport function withRetry<TData>(\n  fn: () => Promise<TData>,\n  {\n    delay: delay_ = 100,\n    retryCount = 2,\n    shouldRetry = () => true,\n  }: {\n    // The delay (in ms) between retries.\n    delay?: ((config: { count: number; error: Error }) => number) | number\n    // The max number of times to retry.\n    retryCount?: number\n    // Whether or not to retry when an error is thrown.\n    shouldRetry?: ({\n      count,\n      error,\n    }: {\n      count: number\n      error: Error\n    }) => Promise<boolean> | boolean\n  } = {},\n) {\n  return new Promise<TData>((resolve, reject) => {\n    const attemptRetry = async ({ count = 0 } = {}) => {\n      const retry = async ({ error }: { error: Error }) => {\n        const delay =\n          typeof delay_ === 'function' ? delay_({ count, error }) : delay_\n        if (delay) await wait(delay)\n        attemptRetry({ count: count + 1 })\n      }\n\n      try {\n        const data = await fn()\n        resolve(data)\n      } catch (err) {\n        if (\n          count < retryCount &&\n          (await shouldRetry({ count, error: err as Error }))\n        )\n          return retry({ error: err as Error })\n        reject(err)\n      }\n    }\n    attemptRetry()\n  })\n}\n"],"mappings":"AAAA,SAASA,IAAI,QAAQ,YAAY;AAEjC,OAAM,SAAUC,SAASA,CACvBC,EAAwB,EAkBlB;EAAA,IAjBN;IACEC,KAAK,EAAEC,MAAM,GAAG,GAAG;IACnBC,UAAU,GAAG,CAAC;IACdC,WAAW,GAAGA,CAAA,KAAM;EAAI,IAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MActB,EAAE;EAEN,OAAO,IAAIG,OAAO,CAAQ,CAACC,OAAO,EAAEC,MAAM,KAAI;IAC5C,MAAMC,YAAY,GAAG,eAAAA,CAAA,EAA6B;MAAA,IAAtB;QAAEC,KAAK,GAAG;MAAC,CAAE,GAAAP,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,EAAE;MAC5C,MAAMQ,KAAK,GAAG,MAAAC,IAAA,IAAsC;QAAA,IAA/B;UAAEC;QAAK,CAAoB,GAAAD,IAAA;QAC9C,MAAMb,KAAK,GACT,OAAOC,MAAM,KAAK,UAAU,GAAGA,MAAM,CAAC;UAAEU,KAAK;UAAEG;QAAK,CAAE,CAAC,GAAGb,MAAM;QAClE,IAAID,KAAK,EAAE,MAAMH,IAAI,CAACG,KAAK,CAAC;QAC5BU,YAAY,CAAC;UAAEC,KAAK,EAAEA,KAAK,GAAG;QAAC,CAAE,CAAC;MACpC,CAAC;MAED,IAAI;QACF,MAAMI,IAAI,GAAG,MAAMhB,EAAE,EAAE;QACvBS,OAAO,CAACO,IAAI,CAAC;OACd,CAAC,OAAOC,GAAG,EAAE;QACZ,IACEL,KAAK,GAAGT,UAAU,KACjB,MAAMC,WAAW,CAAC;UAAEQ,KAAK;UAAEG,KAAK,EAAEE;QAAY,CAAE,CAAC,CAAC,EAEnD,OAAOJ,KAAK,CAAC;UAAEE,KAAK,EAAEE;QAAY,CAAE,CAAC;QACvCP,MAAM,CAACO,GAAG,CAAC;;IAEf,CAAC;IACDN,YAAY,EAAE;EAChB,CAAC,CAAC;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}