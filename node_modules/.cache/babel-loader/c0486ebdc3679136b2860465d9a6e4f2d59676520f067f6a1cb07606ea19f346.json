{"ast":null,"code":"import { RpcRequestError } from '../../errors/request.js';\nimport { UrlRequiredError } from '../../errors/transport.js';\nimport { createBatchScheduler } from '../../utils/promise/createBatchScheduler.js';\nimport { rpc } from '../../utils/rpc.js';\nimport { createTransport } from './createTransport.js';\n/**\n * @description Creates a HTTP transport that connects to a JSON-RPC API.\n */\nexport function http( /** URL of the JSON-RPC API. Defaults to the chain's public RPC URL. */\nurl) {\n  let config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    batch,\n    fetchOptions,\n    key = 'http',\n    name = 'HTTP JSON-RPC',\n    retryDelay\n  } = config;\n  return _ref => {\n    var _config$retryCount, _ref2;\n    let {\n      chain,\n      retryCount: retryCount_,\n      timeout: timeout_\n    } = _ref;\n    const {\n      batchSize = 1000,\n      wait = 0\n    } = typeof batch === 'object' ? batch : {};\n    const retryCount = (_config$retryCount = config.retryCount) !== null && _config$retryCount !== void 0 ? _config$retryCount : retryCount_;\n    const timeout = (_ref2 = timeout_ !== null && timeout_ !== void 0 ? timeout_ : config.timeout) !== null && _ref2 !== void 0 ? _ref2 : 10000;\n    const url_ = url || (chain === null || chain === void 0 ? void 0 : chain.rpcUrls.default.http[0]);\n    if (!url_) throw new UrlRequiredError();\n    return createTransport({\n      key,\n      name,\n      async request(_ref3) {\n        let {\n          method,\n          params\n        } = _ref3;\n        const body = {\n          method,\n          params\n        };\n        const {\n          schedule\n        } = createBatchScheduler({\n          id: `${url}`,\n          wait,\n          shouldSplitBatch(requests) {\n            return requests.length > batchSize;\n          },\n          fn: body => rpc.http(url_, {\n            body,\n            fetchOptions,\n            timeout\n          })\n        });\n        const fn = async body => batch ? schedule(body) : [await rpc.http(url_, {\n          body,\n          fetchOptions,\n          timeout\n        })];\n        const [{\n          error,\n          result\n        }] = await fn(body);\n        if (error) throw new RpcRequestError({\n          body,\n          error,\n          url: url_\n        });\n        return result;\n      },\n      retryCount,\n      retryDelay,\n      timeout,\n      type: 'http'\n    }, {\n      url\n    });\n  };\n}","map":{"version":3,"names":["RpcRequestError","UrlRequiredError","createBatchScheduler","rpc","createTransport","http","url","config","arguments","length","undefined","batch","fetchOptions","key","name","retryDelay","_ref","_config$retryCount","_ref2","chain","retryCount","retryCount_","timeout","timeout_","batchSize","wait","url_","rpcUrls","default","request","_ref3","method","params","body","schedule","id","shouldSplitBatch","requests","fn","error","result","type"],"sources":["/Users/toji.inoue/Desktop/web3-sotuken/node_modules/viem/clients/transports/http.ts"],"sourcesContent":["import { RpcRequestError } from '../../errors/request.js'\nimport { UrlRequiredError } from '../../errors/transport.js'\nimport { createBatchScheduler } from '../../utils/promise/createBatchScheduler.js'\nimport { type HttpOptions, type RpcRequest, rpc } from '../../utils/rpc.js'\n\nimport {\n  type Transport,\n  type TransportConfig,\n  createTransport,\n} from './createTransport.js'\n\nexport type BatchOptions = {\n  /** The maximum number of JSON-RPC requests to send in a batch. @default 1_000 */\n  batchSize?: number\n  /** The maximum number of milliseconds to wait before sending a batch. @default 0 */\n  wait?: number\n}\n\nexport type HttpTransportConfig = {\n  /**\n   * Whether to enable Batch JSON-RPC.\n   * @link https://www.jsonrpc.org/specification#batch\n   */\n  batch?: boolean | BatchOptions\n  /**\n   * Request configuration to pass to `fetch`.\n   * @link https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   */\n  fetchOptions?: HttpOptions['fetchOptions']\n  /** The key of the HTTP transport. */\n  key?: TransportConfig['key']\n  /** The name of the HTTP transport. */\n  name?: TransportConfig['name']\n  /** The max number of times to retry. */\n  retryCount?: TransportConfig['retryCount']\n  /** The base delay (in ms) between retries. */\n  retryDelay?: TransportConfig['retryDelay']\n  /** The timeout (in ms) for the HTTP request. Default: 10_000 */\n  timeout?: TransportConfig['timeout']\n}\n\nexport type HttpTransport = Transport<\n  'http',\n  {\n    url?: string\n  }\n>\n\n/**\n * @description Creates a HTTP transport that connects to a JSON-RPC API.\n */\nexport function http(\n  /** URL of the JSON-RPC API. Defaults to the chain's public RPC URL. */\n  url?: string,\n  config: HttpTransportConfig = {},\n): HttpTransport {\n  const {\n    batch,\n    fetchOptions,\n    key = 'http',\n    name = 'HTTP JSON-RPC',\n    retryDelay,\n  } = config\n  return ({ chain, retryCount: retryCount_, timeout: timeout_ }) => {\n    const { batchSize = 1000, wait = 0 } =\n      typeof batch === 'object' ? batch : {}\n    const retryCount = config.retryCount ?? retryCount_\n    const timeout = timeout_ ?? config.timeout ?? 10_000\n    const url_ = url || chain?.rpcUrls.default.http[0]\n    if (!url_) throw new UrlRequiredError()\n    return createTransport(\n      {\n        key,\n        name,\n        async request({ method, params }) {\n          const body = { method, params }\n\n          const { schedule } = createBatchScheduler({\n            id: `${url}`,\n            wait,\n            shouldSplitBatch(requests) {\n              return requests.length > batchSize\n            },\n            fn: (body: RpcRequest[]) =>\n              rpc.http(url_, {\n                body,\n                fetchOptions,\n                timeout,\n              }),\n          })\n\n          const fn = async (body: RpcRequest) =>\n            batch\n              ? schedule(body)\n              : [await rpc.http(url_, { body, fetchOptions, timeout })]\n\n          const [{ error, result }] = await fn(body)\n          if (error)\n            throw new RpcRequestError({\n              body,\n              error,\n              url: url_,\n            })\n          return result\n        },\n        retryCount,\n        retryDelay,\n        timeout,\n        type: 'http',\n      },\n      {\n        url,\n      },\n    )\n  }\n}\n"],"mappings":"AAAA,SAASA,eAAe,QAAQ,yBAAyB;AACzD,SAASC,gBAAgB,QAAQ,2BAA2B;AAC5D,SAASC,oBAAoB,QAAQ,6CAA6C;AAClF,SAA4CC,GAAG,QAAQ,oBAAoB;AAE3E,SAGEC,eAAe,QACV,sBAAsB;AAuC7B;;;AAGA,OAAM,SAAUC,IAAIA,CAAA,CAClB;AACAC,GAAY,EACoB;EAAA,IAAhCC,MAAA,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAA8B,EAAE;EAEhC,MAAM;IACJG,KAAK;IACLC,YAAY;IACZC,GAAG,GAAG,MAAM;IACZC,IAAI,GAAG,eAAe;IACtBC;EAAU,CACX,GAAGR,MAAM;EACV,OAAOS,IAAA,IAA0D;IAAA,IAAAC,kBAAA,EAAAC,KAAA;IAAA,IAAzD;MAAEC,KAAK;MAAEC,UAAU,EAAEC,WAAW;MAAEC,OAAO,EAAEC;IAAQ,CAAE,GAAAP,IAAA;IAC3D,MAAM;MAAEQ,SAAS,GAAG,IAAI;MAAEC,IAAI,GAAG;IAAC,CAAE,GAClC,OAAOd,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAG,EAAE;IACxC,MAAMS,UAAU,IAAAH,kBAAA,GAAGV,MAAM,CAACa,UAAU,cAAAH,kBAAA,cAAAA,kBAAA,GAAII,WAAW;IACnD,MAAMC,OAAO,IAAAJ,KAAA,GAAGK,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAIhB,MAAM,CAACe,OAAO,cAAAJ,KAAA,cAAAA,KAAA,GAAI,KAAM;IACpD,MAAMQ,IAAI,GAAGpB,GAAG,KAAIa,KAAK,aAALA,KAAK,uBAALA,KAAK,CAAEQ,OAAO,CAACC,OAAO,CAACvB,IAAI,CAAC,CAAC,CAAC;IAClD,IAAI,CAACqB,IAAI,EAAE,MAAM,IAAIzB,gBAAgB,EAAE;IACvC,OAAOG,eAAe,CACpB;MACES,GAAG;MACHC,IAAI;MACJ,MAAMe,OAAOA,CAAAC,KAAA,EAAmB;QAAA,IAAlB;UAAEC,MAAM;UAAEC;QAAM,CAAE,GAAAF,KAAA;QAC9B,MAAMG,IAAI,GAAG;UAAEF,MAAM;UAAEC;QAAM,CAAE;QAE/B,MAAM;UAAEE;QAAQ,CAAE,GAAGhC,oBAAoB,CAAC;UACxCiC,EAAE,EAAE,GAAG7B,GAAG,EAAE;UACZmB,IAAI;UACJW,gBAAgBA,CAACC,QAAQ;YACvB,OAAOA,QAAQ,CAAC5B,MAAM,GAAGe,SAAS;UACpC,CAAC;UACDc,EAAE,EAAGL,IAAkB,IACrB9B,GAAG,CAACE,IAAI,CAACqB,IAAI,EAAE;YACbO,IAAI;YACJrB,YAAY;YACZU;WACD;SACJ,CAAC;QAEF,MAAMgB,EAAE,GAAG,MAAOL,IAAgB,IAChCtB,KAAK,GACDuB,QAAQ,CAACD,IAAI,CAAC,GACd,CAAC,MAAM9B,GAAG,CAACE,IAAI,CAACqB,IAAI,EAAE;UAAEO,IAAI;UAAErB,YAAY;UAAEU;QAAO,CAAE,CAAC,CAAC;QAE7D,MAAM,CAAC;UAAEiB,KAAK;UAAEC;QAAM,CAAE,CAAC,GAAG,MAAMF,EAAE,CAACL,IAAI,CAAC;QAC1C,IAAIM,KAAK,EACP,MAAM,IAAIvC,eAAe,CAAC;UACxBiC,IAAI;UACJM,KAAK;UACLjC,GAAG,EAAEoB;SACN,CAAC;QACJ,OAAOc,MAAM;MACf,CAAC;MACDpB,UAAU;MACVL,UAAU;MACVO,OAAO;MACPmB,IAAI,EAAE;KACP,EACD;MACEnC;KACD,CACF;EACH,CAAC;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}